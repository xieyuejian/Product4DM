Ext.define("Ext.srm.dictionary.SrmCombo",{extend:"Ext.ux.form.ComboBox",alias:"srmCombo",xtype:"srmCombo",triggerAction:"all",valueField:"",displayField:"",innerTpl:true,displayValue:"",storeId:"",storeClassName:"",parentObj:null,parentXtype:"",autoSelectFirst:false,fieldMapping:{},constructor:function(B){var A=this;var B=B||{};if(this.storeId){this.store=Ext.getStore(A.storeId)}if(!this.store){this.store=Ext.create(A.storeClassName)}this.store.on("beforeload",function(D){var C=D.proxy.extraParams;A.fireEvent("combobaseparams",A,C,A.parentObj);Ext.apply(D.proxy.extraParams,C)});A.listeners={"clear":function(C){if(A.isForm()){A.clearForm()}},"afterrender":function(){var C=A.parentObj.findParentByType("window");if(C&&A.isForm()&&A.autoSelectFirst){C.on("show",function(){if(A.store&&A.store.getCount()==1){var D=A.store.getAt(0);A.parentObj.getForm().findField(A.name).setValue(D.get(A.valueField))}})}}},Ext.applyIf(B.listeners,A.listeners);this.callParent([B]);A.getParentObj();if(A.isGrid()){A.parentObj.on("edit",function(D,C){var E=C.field;if(A.dataIndex==E){A.dealGrid(D,C)}})}},getParentObj:function(){var A=this;var B=null;if(!A.parentObj){if(A.column){A.parentObj=A.column.findParentByType(Ext.grid.Panel)}else{A.parentObj=A.findParentByType(Ext.form.Panel);if(!A.parentObj){A.parentObj=A.findParentByType(Ext.grid.Panel)}}}if(A.parentObj){A.parentXtype=A.parentObj.getXType()}},isForm:function(){var A=this;var B=["form","fomrpanel","uxform","uxformpanel"];if(B.indexOf(A.parentXtype)!=-1){return true}else{return false}},isGrid:function(){var A=this;var B=["grid","uxgrid","uxgridpanel","uxeditorgrid","gridpanel"];if(B.indexOf(A.parentXtype)!=-1){return true}else{return false}},onChange:function(C,B){var A=this;if(A.parentXtype.indexOf("form")!=-1){A.dealForm(C,B)}},dealForm:function(D,C){var B=this;var A=B.parentObj.getForm();var E=B.getSelection();if(B.fieldMapping&&E){Ext.Object.each(B.fieldMapping,function(H,F){var G=A.findField(H);if(G){G.setValue(E.get(F))}else{if(Ext.isEmpty(G)){if(!Ext.isIE){console.log("找不到"+H+"对象")}}}})}},clearForm:function(){var B=this;var A=B.parentObj.getForm();if(B.fieldMapping){Ext.Object.each(B.fieldMapping,function(E,C){var D=A.findField(E);if(D){if(B.name==E){B.clearValue()}else{D.reset()}}else{if(!Ext.isIE){console.log("找不到"+E+"对象")}}})}},dealGrid:function(F,A){var H=this;var G=H.dataIndex;var J=A.grid;var I=A.record;var D=A.value;var E=A.field;if(G==E&&!Ext.isEmpty(D)){var B=H.store;var C=B.findRecord(H.valueField,D);if(I){Ext.Object.each(H.fieldMapping,function(K,L){if(L!=E){I.set(K,C.get(L))}});H.fireEvent("selfEdit",F,A);J.fireEvent("selfEdit",F,A)}}if(G==E&&Ext.isEmpty(D)){Ext.Object.each(H.fieldMapping,function(K,L){if(L!=E){I.set(K,"")}})}},assertValue:function(){var D=this,B=D.getRawValue(),G=D.getDisplayValue(),F=D.lastSelectedRecords,C=false,E,A;if(D.forceSelection){if(D.multiSelect){if(B!==G){D.setRawValue(G)}}else{A=D.findRecordByDisplay(B);if(!A){if(F&&D.rawValue){A=F[0]}else{if(D.displayTplData&&D.displayTplData.length){A=D.findRecordByValue(D.displayTplData[0][D.valueField])}}}else{if(D.getDisplayValue([D.getRecordDisplayData(A)])===G){A=null;C=true}}if(A){D.select(A,true);D.fireEvent("select",D,A)}else{if(!C){if(F){delete D.lastSelectedRecords}D.setRawValue("")}}}}else{if((E=D.getValue())&&E==B){A=D.findRecordByDisplay(E);if(A&&(A!==(F&&F[0])||D.displayField!==D.valueField)){D.select(A,true);D.fireEvent("select",D,A)}}}D.collapse()}});